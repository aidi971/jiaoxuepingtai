<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.langheng.modules.ed.dao.CourseDao">
	
	<!-- 查询数据
	<select id="findList" resultType="Course">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		<where>
			${sqlMap.where.toSql()}
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select> -->

	<update id="updateLessonTaskNum">
		UPDATE ed_course a
		SET
		<if test='type=="0"' >
			a.courseware_num =
		</if>
		<if test='type=="1"' >
			a.video_num =
		</if>
		<if test='type=="2" or type=="3"' >
			a.homework_num =
		</if>
		(SELECT count(1) FROM  ed_lesson_task AS lt
		JOIN ed_chapter AS c  ON c.status = '0' AND c.course_id = #{courseId} AND lt.chapter_id = c.chapter_id
		WHERE  lt.status = '0'
			<if test='type=="2" or type=="3"' >
				AND (lt.type='2' OR lt.type='3')
			</if>
			<if test='type!="2" and type!="3"' >
				AND lt.type=#{type}
			</if>
			)
		WHERE a.course_id = #{courseId}
	</update>
	
</mapper>